import{T as L,v as B,u as V}from"./use-expose-287cc7e0.js";import{n as S,t as v,u as T,P as Z,aK as E,ah as J,w as x,aT as q,p as D,g as b,b as R,d as _,k as r,s as $,a8 as Q,i as K,J as M,aU as W,A as j,v as C,y as X,a6 as ee,C as oe,aL as te,aM as ne,a7 as ae,G as se,F as le,H as ce,Y as re}from"./index-5c77cc65.js";import{u as ie}from"./use-touch-38e3a584.js";import{P as ue}from"./on-popup-reopen-e5c081b4.js";import{c as de}from"./interceptor-b6b597e5.js";const F={show:Boolean,zIndex:S,overlay:v,duration:S,teleport:[String,Object],lockScroll:v,lazyRender:v,beforeClose:Function,overlayStyle:Object,overlayClass:T,transitionAppear:Boolean,closeOnClickOverlay:v},pe=Object.keys(F);let h=0;const z="van-overflow-hidden";function fe(e,o){const n=ie(),l=i=>{n.move(i);const k=n.deltaY.value>0?"10":"01",P=q(i.target,e.value),{scrollHeight:u,offsetHeight:I,scrollTop:m}=P;let f="11";m===0?f=I>=u?"00":"01":m+I>=u&&(f="10"),f!=="11"&&n.isVertical()&&!(parseInt(f,2)&parseInt(k,2))&&D(i,!0)},a=()=>{document.addEventListener("touchstart",n.start),document.addEventListener("touchmove",l,{passive:!1}),h||document.body.classList.add(z),h++},s=()=>{h&&(document.removeEventListener("touchstart",n.start),document.removeEventListener("touchmove",l),h--,h||document.body.classList.remove(z))},c=()=>o()&&a(),d=()=>o()&&s();Z(c),E(d),J(d),x(o,i=>{i?a():s()})}function H(e){const o=b(!1);return x(e,n=>{n&&(o.value=n)},{immediate:!0}),n=>()=>o.value?n():null}const[ve,me]=R("overlay"),ye={show:Boolean,zIndex:S,duration:S,className:T,lockScroll:v,lazyRender:v,customStyle:Object};var he=_({name:ve,props:ye,setup(e,{slots:o}){const n=H(()=>e.show||!e.lazyRender),l=s=>{D(s,!0)},a=n(()=>{var s;const c=$(Q(e.zIndex),e.customStyle);return K(e.duration)&&(c.animationDuration=`${e.duration}s`),M(r("div",{style:c,class:[me(),e.className],onTouchmove:e.lockScroll?l:W},[(s=o.default)==null?void 0:s.call(o)]),[[B,e.show]])});return()=>r(L,{name:"van-fade",appear:!0},{default:a})}});const Pe=j(he),Ie=$({},F,{round:Boolean,position:C("center"),closeIcon:C("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:C("top-right"),safeAreaInsetBottom:Boolean}),[we,g]=R("popup");let A=2e3;var Se=_({name:we,inheritAttrs:!1,props:Ie,emits:["open","close","opened","closed","update:show","click-overlay","click-close-icon"],setup(e,{emit:o,attrs:n,slots:l}){let a,s;const c=b(),d=b(),i=H(()=>e.show||!e.lazyRender),k=X(()=>{const t={zIndex:c.value};if(K(e.duration)){const y=e.position==="center"?"animationDuration":"transitionDuration";t[y]=`${e.duration}s`}return t}),P=()=>{a||(e.zIndex!==void 0&&(A=+e.zIndex),a=!0,c.value=++A,o("open"))},u=()=>{a&&de(e.beforeClose,{done(){a=!1,o("close"),o("update:show",!1)}})},I=t=>{o("click-overlay",t),e.closeOnClickOverlay&&u()},m=()=>{if(e.overlay)return r(Pe,{show:e.show,class:e.overlayClass,zIndex:c.value,duration:e.duration,customStyle:e.overlayStyle,onClick:I},{default:l["overlay-content"]})},f=t=>{o("click-close-icon",t),u()},N=()=>{if(e.closeable)return r(re,{role:"button",tabindex:0,name:e.closeIcon,class:[g("close-icon",e.closeIconPosition),ce],classPrefix:e.iconPrefix,onClick:f},null)},Y=()=>o("opened"),G=()=>o("closed"),U=i(()=>{var t;const{round:y,position:w,safeAreaInsetBottom:O}=e;return M(r("div",le({ref:d,style:k.value,class:[g({round:y,[w]:w}),{"van-safe-area-bottom":O}]},n),[(t=l.default)==null?void 0:t.call(l),N()]),[[B,e.show]])}),p=()=>{const{position:t,transition:y,transitionAppear:w}=e,O=t==="center"?"van-fade":`van-popup-slide-${t}`;return r(L,{name:y||O,appear:w,onAfterEnter:Y,onAfterLeave:G},{default:U})};return x(()=>e.show,t=>{t&&!a&&P(),!t&&a&&(a=!1,o("close"))}),V({popupRef:d}),fe(d,()=>e.show&&e.lockScroll),ee("popstate",()=>{e.closeOnPopstate&&(u(),s=!1)}),oe(()=>{e.show&&P()}),te(()=>{s&&(o("update:show",!0),s=!1)}),E(()=>{e.show&&(u(),s=!0)}),ne(ue,()=>e.show),()=>e.teleport?r(ae,{to:e.teleport},{default:()=>[m(),p()]}):r(se,null,[m(),p()])}});const ze=j(Se);export{Pe as O,ze as P,pe as a,F as p,H as u};
